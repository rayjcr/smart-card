webpackJsonp([5],{A66B:function(e,t,r){e.exports=function(e){return function(){return r("Opzk")("./"+e+".vue")}}},M8wA:function(e,t){},NHnr:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("7+uW"),o=r("d7EF"),a=r.n(o),s=r("//Fk"),i=r.n(s),c=r("Xxa5"),u=r.n(c),l=r("exGp"),p=r.n(l),d=r("P9l9"),m=r("mCTZ"),w={name:"App",data:function(){return{timeSwipe:Object,timeSwallow:Object}},watch:{$route:function(e,t){}},mounted:function(){Object(m.b)();try{window.require("electron").ipcRenderer.send("openServer")}catch(e){console.log("非桌面应用启动")}this.getServer()},methods:{getServer:function(){var e=this;return p()(u.a.mark(function t(){return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,console.log("111222"),t.next=4,d.j();case 4:if(!t.sent){t.next=10;break}return t.next=7,e.openPort();case 7:t.sent,t.next=11;break;case 10:setTimeout(e.getServer(),1e3);case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(0),e.getServer();case 16:case"end":return t.stop()}},t,e,[[0,13]])}))()},openPort:function(){var e=this;return p()(u.a.mark(function t(){var r,n,o,s;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.$LayerTips({content:"系统初始化请稍后",time:2e3}),t.next=3,i.a.all([d.c(),d.d()]);case 3:return t.sent,t.next=6,i.a.all([d.t(),d.u(),d.s()]);case 6:return t.sent,t.next=9,i.a.all([d.w(),d.x()]);case 9:if(r=t.sent,n=a()(r,2),o=n[0],s=n[1],console.log(o,s,"Promise.all的返回"),-3!=o.resultCode&&-3!=s.resultCode){t.next=18;break}return e.$LayerTips({content:"设备初始化失败<br>请联系管理员<br>",time:2e3}),setTimeout(e.openPort(),2e3),t.abrupt("return",!1);case 18:return e.initPolling(),console.log("3个串口都已启动"),t.abrupt("return",!0);case 21:case"end":return t.stop()}},t,e)}))()},initPolling:function(){var e=this;return p()(u.a.mark(function t(){return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,d.r();case 2:t.sent,clearInterval(e.timeSwipe),e.timeSwipe=setInterval(p()(u.a.mark(function t(){return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.isSwipeCard();case 2:case"end":return t.stop()}},t,e)})),1e3),clearInterval(e.timeSwallow),e.timeSwallow=setInterval(p()(u.a.mark(function t(){return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.isSwallowCard();case 2:case"end":return t.stop()}},t,e)})),1e3);case 7:case"end":return t.stop()}},t,e)}))()},isSwipeCard:function(){var e=this;return p()(u.a.mark(function t(){var r;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(window.localStorage.getItem("token")||-1==e.$router.currentRoute.path.indexOf("index")&&e.$router.push({path:"/"}),0==e.$store.getters.swipeState){t.next=9;break}return console.log(e.$store.getters.swipeState,"this.$store.getters.swipeState"),t.next=5,d.x();case 5:return r=t.sent,console.log(r,"获取了身份卡卡号"),1==r.resultCode&&(e.$store.dispatch("SetSwipeState",0),e.$store.getters.confirmExchange?e.checkUser(r.value):e.getStudentInfo(r.value)),t.abrupt("return",!1);case 9:return t.abrupt("return",!1);case 10:case"end":return t.stop()}},t,e)}))()},getStudentInfo:function(e){var t=this;return p()(u.a.mark(function r(){var n,o,a,s,i;return u.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return(n={}).cardNo=e,r.prev=2,r.next=5,d.m(n);case 5:if(1==(o=r.sent).resultCode){r.next=10;break}return console.log("6666699999"),t.$store.dispatch("SetErrorState",!0),r.abrupt("return");case 10:return console.log(o.value,"res.value"),a=JSON.parse(o.value),window.localStorage.setItem("card_No",e),window.localStorage.setItem("card_userid",a.userCode),window.localStorage.setItem("card_oauserid","3"+a.userCode.substr(1,a.userCode.length)),window.localStorage.setItem("card_useravatar",a.avatar),window.localStorage.setItem("xxdm",a.schoolCode),r.next=19,d.n({xxdm:window.localStorage.getItem("xxdm"),usercode:"4"+a.userCode.substr(1,a.userCode.length),platform:0});case 19:return 200==(s=r.sent).status?window.localStorage.setItem("token",s.data):t.$store.dispatch("SetErrorState",!0),r.next=23,d.l({schoolCode:window.localStorage.getItem("xxdm"),studentId:window.localStorage.getItem("card_oauserid")});case 23:i=r.sent,console.log(i,"stuRes"),1==i.resultCode?(window.localStorage.setItem("classId",i.value.classId),window.localStorage.setItem("className",i.value.className),window.localStorage.setItem("gradeId",i.value.gradeId),window.localStorage.setItem("card_username",i.value.name)):t.$store.dispatch("SetErrorState",!0),t.$store.dispatch("SetSwipeComplete",!0),r.next=32;break;case 29:r.prev=29,r.t0=r.catch(2),t.$store.dispatch("SetErrorState",!0);case 32:case"end":return r.stop()}},r,t,[[2,29]])}))()},checkUser:function(e){e==window.localStorage.getItem("card_No")?(console.log("用户是同一个,确认通过"),this.$store.dispatch("SetCheckComplete",!0)):(console.log("不是同一个用户"),this.$store.dispatch("SetErrorState",!0))},isSwallowCard:function(){var e=this;return p()(u.a.mark(function t(){var r;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(0==e.$store.getters.swallowState){t.next=6;break}return t.next=3,d.w();case 3:return 1==(r=t.sent).resultCode&&(e.$store.dispatch("SetSwallowState",0),e.$store.dispatch("SetSwallowComplete",!0),window.localStorage.setItem("card_No",r.value),console.log("已经读到了卡片")),t.abrupt("return",!1);case 6:return t.abrupt("return",!1);case 7:case"end":return t.stop()}},t,e)}))()},getTokenTest:function(){var e=this;return p()(u.a.mark(function t(){var r,n;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="40190423170521425",window.localStorage.setItem("card_userid",r),window.localStorage.setItem("card_oauserid",r.replace("4","3")),e.next=5,d.n({xxdm:"1544",usercode:r,platform:0});case 5:if(200!=(n=e.sent).status){e.next=11;break}return window.localStorage.setItem("token",n.data),e.abrupt("return",!0);case 11:return e.abrupt("return",!1);case 12:case"end":return e.stop()}},t,e)}))()}}},f={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("transition",{attrs:{name:"sliderRight"}},[t("router-view")],1)],1)},staticRenderFns:[]};var h=r("VU/8")(w,f,!1,function(e){r("oZuQ")},null,null).exports,S=r("YaEn"),g=r("NYxO"),v=(r("lbHh"),{state:{swipeState:0,swallowState:0,machineState:!1,swipeComplete:!1,swallowComplete:!1,errorState:!1,confirmExchange:!1,checkComplete:!1},mutations:{Set_SwipeState:function(e,t){e.swipeState=t},Set_SwallowState:function(e,t){e.swallowState=t},Set_MachineState:function(e,t){e.machineState=t},Set_SwallowComplete:function(e,t){e.swallowComplete=t},Set_SwipeComplete:function(e,t){e.swipeComplete=t},Set_ErrorState:function(e,t){e.errorState=t},Set_ConfirmExchange:function(e,t){e.confirmExchange=t},Set_CheckComplete:function(e,t){e.checkComplete=t}},actions:{SetSwipeState:function(e,t){(0,e.commit)("Set_SwipeState",t)},SetSwallowState:function(e,t){(0,e.commit)("Set_SwallowState",t)},SetMachineState:function(e,t){(0,e.commit)("Set_MachineState",t)},SetSwipeComplete:function(e,t){(0,e.commit)("Set_SwipeComplete",t)},SetSwallowComplete:function(e,t){(0,e.commit)("Set_SwallowComplete",t)},SetErrorState:function(e,t){(0,e.commit)("Set_ErrorState",t)},SetConfirmExchange:function(e,t){(0,e.commit)("Set_ConfirmExchange",t)},SetCheckComplete:function(e,t){(0,e.commit)("Set_CheckComplete",t)}}}),x={errorState:function(e){return e.app.errorState},swipeState:function(e){return e.app.swipeState},swallowState:function(e){return e.app.swallowState},machineState:function(e){return e.app.machineState},swipeComplete:function(e){return e.app.swipeComplete},swallowComplete:function(e){return e.app.swallowComplete},confirmExchange:function(e){return e.app.confirmExchange},checkComplete:function(e){return e.app.checkComplete}};n.a.use(g.a);var C=new g.a.Store({modules:{app:v},getters:x}),k=r("oPmM"),b=r.n(k),I={name:"MyMessage",data:function(){return{content:"",time:3e3,visible:!1}},mounted:function(){0!=this.time&&this.close()},methods:{handleAfterLeave:function(){this.$destroy(!0),this.$el.parentNode.removeChild(this.$el)},close:function(){var e=this;window.setTimeout(function(){e.visible=!1},this.time)}}},_={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"tipsBox"},[t("transition",{attrs:{name:"tips"},on:{"after-leave":this.handleAfterLeave}},[t("div",{directives:[{name:"show",rawName:"v-show",value:this.visible,expression:"visible"}],staticClass:"hDialog"},[t("div",{domProps:{innerHTML:this._s(this.content)}})])])],1)},staticRenderFns:[]};var $=r("VU/8")(I,_,!1,function(e){r("M8wA")},"data-v-641ae3e0",null).exports,T=n.a.extend($);T.install=function(e,t){void 0===e||null===e?e={content:""}:"string"!=typeof e&&"number"!=typeof e||(e={content:e},void 0!=t&&null!=e&&(e.type=t));var r=new T({data:e}).$mount();document.body.appendChild(r.$el),n.a.nextTick(function(){r.visible=!0})};var E=T;!function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.prototype.$LayerTips=E.install}(n.a);var y=r("K/Lq"),P=r.n(y);n.a.use(P.a),n.a.use(b.a),window.countDownTime=0,n.a.config.productionTip=!1,new n.a({el:"#app",router:S.a,store:C,components:{App:h},template:"<App/>"})},Opzk:function(e,t,r){var n={"./exchange.vue":["oT9y",0],"./index.vue":["8hXn",3],"./mall.vue":["aFB9",1],"./order.vue":["vF69",2]};function o(e){var t=n[e];return t?r.e(t[1]).then(function(){return r(t[0])}):Promise.reject(new Error("Cannot find module '"+e+"'."))}o.keys=function(){return Object.keys(n)},o.id="Opzk",e.exports=o},P9l9:function(e,t,r){"use strict";var n=r("//Fk"),o=r.n(n),a=r("mtWM"),s=r.n(a),i=r("7+uW"),c=(r("mCTZ"),s.a.create({timeout:2e4}));c.interceptors.request.use(function(e){return window.localStorage.getItem("token"),window.localStorage.getItem("token")&&(e.headers.Authorization=window.localStorage.getItem("token")),e},function(e){o.a.reject(e)}),c.interceptors.response.use(function(e){var t=e.data;return 401===e.status||40101===t.status?o.a.reject("error"):40301===t.status?o.a.reject("error"):200===e.status||200===t.status?e.data:void i.a.prototype.$LayerTips({content:"加载信息出错",time:2e3})},function(e){if("arraybuffer"==e.response.request.responseType){var t=e.response.data,r=new Blob([t]),n=new FileReader;n.readAsText(r,"utf-8"),n.onload=function(e){}}else{e.message;if(e.response&&e.response.data)e.response.data,401===e.response.status||i.a.prototype.$LayerTips({content:"访问数据出错",time:2e3})}return o.a.reject(e)});var u=c;t.n=function(e){return u({url:d+"/auth/jwt/xxtToken",method:"POST",params:e})},t.l=function(e){return u({url:d+"/base/baseApi/getStudentDetail",method:"get",params:e})},t.a=function(e){return u({url:""+d+l+"/atmRecord/save",method:"POST",data:e})},t.i=function(e){return u({url:""+d+l+"/goodsType/list",method:"get",params:e})},t.g=function(e){return u({url:""+d+l+"/goods/listPage",method:"post",data:e})},t.h=function(e){return u({url:""+d+l+"/goodsOrder/listPage",method:"post",data:e})},t.t=function(){return u({url:p+"/openrc",method:"post"})},t.u=function(){return u({url:p+"/userOpenPort",method:"post"})},t.c=function(){return u({url:p+"/closerc",method:"post"})},t.d=function(){return u({url:p+"/userClosePort",method:"post"})},t.s=function(){return u({url:p+"/opencardport",method:"post"})},t.x=function(){return u({url:p+"/userGetCard",method:"post"})},t.w=function(){return u({url:p+"/getcard",method:"post"})},t.q=function(){return u({url:p+"/intocard",method:"post"})},t.v=function(){return u({url:p+"/outcard",method:"post"})},t.r=function(){return u({url:p+"/noUse",method:"post"})},t.b=function(){return u({url:p+"/canUse",method:"post"})},t.j=function(){return u({url:p+"/getPid",method:"get"})},t.f=function(e){return u({url:""+d+l+"/goodsOrder/exchange",method:"POST",data:e})},t.o=function(e){return u({url:""+d+l+"/characterItem/getUserMedalInfo",method:"get",params:e})},t.p=function(e){return u({url:""+d+l+"/reportCard/getStuEvaluationData/"+e.userId,method:"get"})},t.m=function(e){return u({url:p+"/GetStudentInfoByCard?school="+e.xxdm+"&card="+e.cardNo,method:"post"})},t.k=function(e){return u({url:""+d+l+"/remindRecord/getEvaluationRemindVO",method:"get",params:e})},t.e=function(e){return u({url:""+d+l+"/remindRecord/deductionByEvaluation",method:"get",params:e})};var l="/evaluation",p="",d="";p="http://localhost:5555",d="http://oa.91118.com:8765/api"},YaEn:function(e,t,r){"use strict";var n=r("7+uW"),o=r("/ocq"),a=r("A66B");n.a.use(o.a),t.a=new o.a({routes:[{path:"/",redirect:"/index"},{path:"/index",component:a("index"),name:"index"},{path:"/mall",component:a("mall"),name:"mall"},{path:"/order",component:a("order"),name:"order"},{path:"/exchange",component:a("exchange"),name:"exchange"}]})},mCTZ:function(e,t,r){"use strict";t.b=function(){window.countDownTime=30},t.a=function(){return window.localStorage.removeItem("token"),void(timerToken=null)};r("YaEn")},oPmM:function(e,t){},oZuQ:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.c8b27270c23542001116.js.map