webpackJsonp([1],{"9bBU":function(t,s,e){e("mClu");var i=e("FeBl").Object;t.exports=function(t,s,e){return i.defineProperty(t,s,e)}},C4MV:function(t,s,e){t.exports={default:e("9bBU"),__esModule:!0}},X954:function(t,s){},aFB9:function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var i=e("bOdI"),a=e.n(i),n=e("Xxa5"),o=e.n(n),r=e("exGp"),c=e.n(r),u=e("mCTZ"),l=e("P9l9"),d={data:function(){return{stateImgUrl:"./static/img/identityCard.gif",isMask:!1,orderDialog:!1,isLoad:!1,isAllType:!0,goodsTypeList:[],goodsTotle:0,goodsLimit:20,goodsCurPage:1,goodsList:[],punishList:[],curTypeId:"0",curGoods:{},medalNum:0,waitLayer:!1,isResult:!1,isErr:!1,punishLayer:!1,punishconfirmLayer:!1,curCardItem:{},exchangeNum:1,userName:"",className:"",countDown:0,isLimit:!1,timeoutObj:null}},computed:{errState:function(){return this.$store.getters.errorState},checkComplete:function(){return this.$store.getters.checkComplete}},destroyed:function(){clearTimeout(this.timeoutObj)},watch:{errState:function(t){t&&(console.log("哇错误~~~~"),this.isErr=!0,this.errExchange(),this.$store.dispatch("SetErrorState",!1))},checkComplete:function(t){t&&(console.log("这里调用兑换的方法"),this.$store.dispatch("SetCheckComplete",!1),this.completeExchange())}},mounted:function(){this.init(),this.$refs.restartTime.addEventListener("mousedown",this.restartTime),this.$refs.scrollGoods.addEventListener("scroll",this.checkScroll)},methods:a()({init:function(){var t=this;return c()(o.a.mark(function s(){return o.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:t.userName=window.localStorage.getItem("card_username"),t.className=window.localStorage.getItem("className"),t.countDown=window.countDownTime,t.countDownInterval(),t.getGoodsTypeList(),t.getGoodsList(),t.getUserMedal(),t.getRemindVOList();case 8:case"end":return s.stop()}},s,t)}))()},countDownInterval:function(){var t=this;this.timeoutObj=setTimeout(function(){t.countDown--,t.countDown>0?t.countDownInterval():t.backHome()},1e3)},getRemindVOList:function(){var t=this;return c()(o.a.mark(function s(){var e;return o.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,l.k({studentId:window.localStorage.getItem("card_oauserid")});case 2:e=s.sent,t.punishList=e.value,t.isLimit=0!=t.punishList.length;case 5:case"end":return s.stop()}},s,t)}))()},getUserMedal:function(){var t=this;return c()(o.a.mark(function s(){var e;return o.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,l.o({userId:window.localStorage.getItem("card_oauserid")});case 2:e=s.sent,t.medalNum=e.value.copyMedalNum;case 4:case"end":return s.stop()}},s,t)}))()},getGoodsTypeList:function(){var t=this;return c()(o.a.mark(function s(){var e;return o.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,l.i({schoolCode:window.localStorage.getItem("xxdm")});case 2:1==(e=s.sent).resultCode?(t.goodsTypeList=e.value,t.cancelTypeCheck()):Vue.prototype.$LayerTips({content:"加载信息出错",time:2e3});case 4:case"end":return s.stop()}},s,t)}))()},cancelTypeCheck:function(){for(var t=0;t<this.goodsTypeList.length;t++)this.$set(this.goodsTypeList[t],"ischeck",!1)},checkAll:function(){this.isAllType=!0,this.curTypeId=0,this.cancelTypeCheck(),this.goodsCurPage=1,this.goodsList=[],this.getGoodsList()},checkType:function(t){this.isAllType=!1,this.curTypeId=t.id,this.cancelTypeCheck(),this.$set(t,"ischeck",!0),this.goodsCurPage=1,this.goodsList=[],this.getGoodsList()},getGoodsList:function(){var t=this;return c()(o.a.mark(function s(){var e,i;return o.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return t.isLoad=!0,(e={}).typeId="0"==t.curTypeId?"":t.curTypeId,e.limit=t.goodsLimit,e.name="",e.page=t.goodsCurPage,s.next=8,l.g(e);case 8:i=s.sent,t.goodsTotle=i.value.totalCount,t.goodsList.push.apply(t.goodsList,i.value.dataList),t.checkScroll();case 12:case"end":return s.stop()}},s,t)}))()},checkScroll:function(){this.restartTime();var t=this.$refs.scrollGoods.scrollTop,s=this.$refs.scrollGoods.clientHeight,e=this.$refs.scrollGoods.scrollHeight;this.goodsCurPage<Math.ceil(this.goodsTotle/this.goodsLimit)&&t+s+100>e?(this.goodsCurPage++,this.getGoodsList()):this.isLoad=!1},myOrder:function(){this.restartTime(),this.$router.push({path:"order"})},exchangeGoods:function(t){this.isMask=!0,this.orderDialog=!0,this.curGoods=t,this.$store.dispatch("SetCheckComplete",!1)},closeDialog:function(){this.isMask=!1,this.orderDialog=!1,this.punishLayer=!1,this.punishconfirmLayer=!1},openPunish:function(){this.isMask=!0,this.punishLayer=!0},backHome:function(){this.$router.push({path:"/index"})},submitBuy:function(){if(this.curGoods.price>this.medalNum)return!1;this.$store.dispatch("SetConfirmExchange",!0),this.$store.dispatch("SetSwipeState",1),this.isMask=!0,this.waitLayer=!0},errExchange:function(){this.$store.dispatch("SetConfirmExchange",!1),this.orderDialog=!1,this.waitLayer=!1,this.isResult=!0},cancelLayer:function(){this.waitLayer=!1,this.isMask=!1,this.orderDialog=!1,this.isResult=!1,this.punishconfirmLayer=!1,this.punishLayer=!1,this.$store.dispatch("SetCheckComplete",!1)},completeExchange:function(){var t=this;return c()(o.a.mark(function s(){var e;return o.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return(e={}).device=3,e.goodsId=t.curGoods.id,e.schoolCode=window.localStorage.getItem("xxdm"),e.stuNo=window.localStorage.getItem("card_oauserid"),s.next=7,l.f(e);case 7:1==s.sent.resultCode?(t.isErr=!1,t.isResult=!0,t.waitLayer=!1,t.orderDialog=!1,t.getUserMedal()):t.$store.dispatch("SetErrorState",!0),t.$store.dispatch("SetConfirmExchange",!1),t.restartTime();case 11:case"end":return s.stop()}},s,t)}))()},punishConfirm:function(t){this.curCardItem=t,this.punishLayer=!1,this.punishconfirmLayer=!0},subtraction:function(){this.exchangeNum<=1?this.exchangeNum=1:this.exchangeNum--},plus:function(){this.exchangeNum>=this.curCardItem.count?this.exchangeNum=this.curCardItem.count:this.exchangeNum++},submitPunish:function(){var t=this;return c()(o.a.mark(function s(){var e,i,a;return o.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return e=t,(i={}).studentId=window.localStorage.getItem("card_oauserid"),i.num=t.exchangeNum,i.evaluationId=t.curCardItem.id,s.next=7,l.e(i);case 7:a=s.sent,console.log(a,"抵消卡res"),1==a.resultCode?(t.closeDialog(),t.getRemindVOList(),setTimeout(function(){e.getUserMedal()},1e3),t.$LayerTips({content:"抵消完成",time:1e3})):t.$LayerTips({content:a.resultMessage,time:2e3}),t.restartTime();case 11:case"end":return s.stop()}},s,t)}))()},restartTime:function(){console.log(window.countDownTime,"window.countDownTime"),this.countDown=window.countDownTime}},"backHome",function(){var t=this;return c()(o.a.mark(function s(){return o.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,l.r();case 2:s.sent,window.localStorage.removeItem("token"),t.$store.dispatch("SetSwipeState",0),t.$store.dispatch("SetSwallowState",0),t.$store.dispatch("SetConfirmExchange",!1),Object(u.a)(),t.$router.push({path:"/"});case 9:case"end":return s.stop()}},s,t)}))()})},h={render:function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{ref:"restartTime",staticClass:"mainFrame appabs"},[e("div",{staticClass:"frameHead"},[e("div",{staticClass:"leftHead"},[e("div",{staticClass:"backPage",on:{click:t.backHome}},[t._v("商城")])]),t._v(" "),t.isLimit?e("div",{staticClass:"punishCard",on:{click:t.openPunish}},[e("div",{staticClass:"punishTit"},[t._v("惩罚卡:")]),t._v(" "),e("div",{staticClass:"punishList"},t._l(t.punishList,function(t,s){return e("div",{staticClass:"cardbox"},[e("img",{attrs:{src:t.icon}})])}),0)]):t._e(),t._v(" "),e("div",{staticClass:"myCoin"},[e("div",{staticClass:"coinNum"},[t._v("可用："+t._s(t.medalNum))])]),t._v(" "),e("div",{staticClass:"rightHead"},[e("div",{staticClass:"info"},[e("span",[t._v(t._s(t.userName))]),e("span",[t._v(t._s(t.className))]),e("span",{on:{click:t.backHome}},[t._v("退出("+t._s(t.countDown)+"s)")])])])]),t._v(" "),e("div",{staticClass:"frameBody"},[e("div",{staticClass:"navMain"},[e("div",{staticClass:"scrollNav"},[e("div",{staticClass:"nav",class:{cur:t.isAllType},on:{click:function(s){return t.checkAll()}}},[e("span",[t._v("全部")])]),t._v(" "),t._l(t.goodsTypeList,function(s,i){return e("div",{key:i,staticClass:"nav",class:{cur:s.ischeck},on:{click:function(e){return t.checkType(s)}}},[e("span",[t._v(t._s(s.name))])])})],2),t._v(" "),e("div",{staticClass:"myOrder",on:{click:t.myOrder}},[e("span",[t._v("我的订单")])])]),t._v(" "),e("div",{ref:"scrollGoods",staticClass:"contMain"},[e("transition",{attrs:{name:"fadeIn"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:!t.isLoad,expression:"!isLoad"}],ref:"goodsList",staticClass:"goodsList"},t._l(t.goodsList,function(s,i){return e("div",{key:i,staticClass:"goodsUnit",class:{limit:t.isLimit}},[e("div",{staticClass:"goodsImg"},[e("img",{attrs:{src:s.picture}})]),t._v(" "),e("div",{staticClass:"goodsTit"},[t._v("\n                            "+t._s(s.name)+"\n                            "),e("span",{staticClass:"surplus"},[t._v("剩余"+t._s(s.reserve)+"件")])]),t._v(" "),e("div",{staticClass:"goodsExchange"},[e("span",{staticClass:"icon"},[t._v(t._s(s.price))]),t._v(" "),e("div",{staticClass:"exchageBtn",on:{click:function(e){return t.exchangeGoods(s)}}},[t._v("兑换")])])])}),0)])],1)]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isMask,expression:"isMask"}],staticClass:"mask",on:{click:t.cancelLayer}}),t._v(" "),e("transition",{attrs:{name:"sliderRight"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.punishconfirmLayer,expression:"punishconfirmLayer"}],staticClass:"punishConfirmDialog"},[e("div",{staticClass:"punishTit"},[t._v("抵消确认")]),t._v(" "),e("div",{staticClass:"punishCont"},[e("div",{staticClass:"row"},[e("div",{staticClass:"tit"},[t._v("抵消"),e("span",[t._v("["+t._s(t.curCardItem.name)+"]")]),t._v("数量")]),t._v(" "),e("div",{staticClass:"num"},[e("div",{staticClass:"subtraction",on:{click:t.subtraction}},[t._v("-")]),t._v(" "),e("div",{staticClass:"numText"},[t._v(t._s(t.exchangeNum))]),t._v(" "),e("div",{staticClass:"plus",on:{click:t.plus}},[t._v("+")])])]),t._v(" "),e("div",{staticClass:"row"},[e("div",{staticClass:"xhTips"},[t._v("需要消耗"),e("span",[t._v(t._s(t.exchangeNum*t.curCardItem.number))]),t._v("勋章，确认抵消？")])])]),t._v(" "),e("div",{staticClass:"layerBtn"},[e("div",{staticClass:"cancelBtn",on:{click:t.closeDialog}},[t._v("取消")]),t._v(" "),e("div",{staticClass:"confirmBtn",on:{click:t.submitPunish}},[t._v("确定")])])])]),t._v(" "),e("transition",{attrs:{name:"sliderRight"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.punishLayer,expression:"punishLayer"}],staticClass:"punishDialog"},[e("div",{staticClass:"punishTit"},[t._v("惩罚卡")]),t._v(" "),e("div",{staticClass:"punishCont"},t._l(t.punishList,function(s,i){return e("div",{staticClass:"cardbox",on:{click:function(e){return t.punishConfirm(s)}}},[e("div",{staticClass:"cardImg"},[e("img",{attrs:{src:s.icon}})]),t._v(" "),e("div",{staticClass:"cardTit"},[e("div",{staticClass:"tit"},[e("span",{staticClass:"name canDeduction",class:{no:0==s.canDeduction}},[t._v(t._s(s.name))])]),t._v(" "),e("div",{staticClass:"num"},[t._v("x"+t._s(s.count))])])])}),0)])]),t._v(" "),e("transition",{attrs:{name:"fadeIn"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.orderDialog,expression:"orderDialog"}],staticClass:"layerOrder"},[e("div",{staticClass:"layerClose",on:{click:t.closeDialog}}),t._v(" "),e("div",{staticClass:"layerTit"},[t._v("兑换确认")]),t._v(" "),e("div",{staticClass:"layerCont"},[t._v("确认兑换"),e("span",[t._v(t._s(t.curGoods.name))]),t._v("?\n        "),t.curGoods.price>t.medalNum?e("div",{staticClass:"warningTips"},[t._v("余额不足，请继续努力")]):t._e()]),t._v(" "),e("div",{staticClass:"layerBtn"},[e("div",{staticClass:"cancelBtn",on:{click:t.closeDialog}},[t._v("取消")]),t._v(" "),e("div",{staticClass:"confirmBtn",class:{disable:t.curGoods.price>t.medalNum},on:{click:t.submitBuy}},[t._v("确定")])])])]),t._v(" "),e("transition",{attrs:{name:"sliderRight"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.waitLayer,expression:"waitLayer"}],staticClass:"waitDialog"},[e("div",{staticClass:"waitTit"},[t._v("请刷学生卡")]),t._v(" "),e("div",{staticClass:"waitGif"},[e("img",{attrs:{src:t.stateImgUrl}})])])]),t._v(" "),e("transition",{attrs:{name:"sliderRight"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.isResult,expression:"isResult"}],staticClass:"exchangeResult"},[e("div",{staticClass:"resultContent",class:[t.isErr?"err":"right"]},[t._v(t._s(t.isErr?"兑换失败":"兑换成功"))])])])],1)},staticRenderFns:[]};var v=e("VU/8")(d,h,!1,function(t){e("X954")},"data-v-38ba0d1e",null);s.default=v.exports},bOdI:function(t,s,e){"use strict";s.__esModule=!0;var i,a=e("C4MV"),n=(i=a)&&i.__esModule?i:{default:i};s.default=function(t,s,e){return s in t?(0,n.default)(t,s,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[s]=e,t}},mClu:function(t,s,e){var i=e("kM2E");i(i.S+i.F*!e("+E39"),"Object",{defineProperty:e("evD5").f})}});
//# sourceMappingURL=1.f49bbd114534393bd477.js.map